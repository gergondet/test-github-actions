cmake_minimum_required(VERSION 3.20)

project(WindowsDownload LANGUAGES CXX)

message("CMAKE_TLS_VERIFY IS ${CMAKE_TLS_VERIFY}")

set(BOOST_VERSION "1.77.0")
set(BOOST_VERSION_ "1_77_0")
set(MSVC_TOOLSET_VERSION_DOT "14.2")
set(URL "http://sourceforge.net/projects/boost/files/boost-binaries/${BOOST_VERSION}/boost_${BOOST_VERSION_}-msvc-${MSVC_TOOLSET_VERSION_DOT}-64.exe")
set(DESTINATION "boot.exe")
set(EXPECTED_SHA256 8cf6bb866ff83922b19a7418e94bc1fce87cae0dea6077624e44de3c6e27505a)
file(DOWNLOAD "${URL}" "${DESTINATION}" LOG DOWNLOAD_LOG STATUS DOWNLOAD_STATUS)

if(DOWNLOAD_STATUS EQUAL 0)
  message("Download OK")
  message("Download log":)
  message("")
  message("${DOWNLOAD_LOG}")
else()
  message("Download failed")
  message("Download log":)
  message("")
  message("${DOWNLOAD_LOG}")
endif()

file(SHA256 "${DESTINATION}" DOWNLOAD_HASH)
if(NOT "${DOWNLOAD_HASH}" STREQUAL "${EXPECTED_SHA256}")
  message(FATAL_ERROR "Download failed, see above")
endif()
